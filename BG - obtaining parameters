import numpy as np
from scipy.optimize import curve_fit
import matplotlib.pyplot as plt
import scipy.integrate as integrate 
import math

data = np.loadtxt('0T.txt')
temp = data[:, 0]
res = data[:, 1]
t = list(temp)
Res = list(res)



def Bloch(temp, A, theta_r):
    ydata = []
    n = 5
    for i in range (len(temp)):
        lower, upper = 0, theta_r/temp[i]
        x = lambda t: (t**(n))/((math.exp(t)-1) * (1-math.exp(-t)))
        integral, error = integrate.quad(x,lower,upper)
        ydata.append((A*(temp[i]/theta_r)**n) * integral)
    return ydata
    
#estimate the parameters

A = 7*10**-4
theta_r = 230

#use curve fit to output optimised parameters into pop

popt, pcov = curve_fit(Bloch, temp, res, p0=[A,theta_r])
A, theta_r = popt

#plotting experimental, estimated parameter and fitted data

plt.figure()
plt.xlabel("Temperature [K]")
plt.ylabel("Resistivity [$\Omega$]")
plt.title("Fitting the Bloch Gruneisen function to the experimental data to obtain the parameters", pad=20)
plt.plot(temp, res, 'k.', ms=1, label='data')
plt.plot(temp, Bloch(temp, *popt),'r.', ms=1, label='fitted parameters')
plt.legend()
